---
title: 'Horvitz–Thompson and Weighted Least Squares'
date: 2023-01-29
permalink: /posts/2023/01/blog-post-1/
tags:
  - Methodology
  - Causal Inference
---


Inverse probability weighting (IPW) is a popular tool for estimating the average treatment effect (ATE) of a binary variable under the conditional ignorability assumption. There are multiple variants of IPW. Particularly, I used to be intrigued by the relationship between the so-called Horvitz–Thompson (HT) estimator and the Weighted Least Squares (WLS) estimator, both of which implement IPW. Both estimators are introduced in popular causal inference textbooks. For example, Angrist and Pischke (2009, p.82) focus on the HT estimator, while Winship and Morgan (2014, p228-9) focus on the WLS estimator. However, I haven't seen them introduced together in these textbooks, and their relationship could seem a little confusing. In fact, a quick simulation would reveal that the classic version of the HT estimator gives a different ATE estimate from that given by the WLS estimator in any given (finite) sample. 

As it turns out, the WLS estimator exactly coincides with a "stablized" version of the HT estimator. Let $Y$ be the outcome, $T$ be a binary treatment, and $w=E(T \mid X)$ be the propensity score defined in terms of covariates $X$. Then the stablized HT estimator is 
<p style="text-align: center;">$$ \frac{\frac{1}{n} \sum  \frac{T_i}{w_i} Y_i }{ \frac{1}{n} \sum \frac{T_i}{w_i} } - \frac{\frac{1}{n} \sum \frac{1-T_i}{1-w_i} Y_i}{\frac{1}{n} \sum \frac{1-T_i}{1-w_i}}. $$</p>
The classic HT estimator is just (1) without the denominators. And the WLS estimator is 
